<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Interlinear Bible Reader</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/?size=48&id=ho7FUWP8PGIX&format=png">

    <!-- Google Fonts for reading fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=EB+Garamond:wght@400;500;600&family=Inter:wght@400;500;600;700&family=Libre+Baskerville:wght@400;700&family=Literata:wght@400;500;600&family=Lora:wght@400;500;600&family=Merriweather:wght@400;700&family=Open+Sans:wght@400;500;600&family=Roboto:wght@400;500;700&family=Source+Serif+4:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="IBRstyle.css">

    <script>
        // Apply saved settings immediately to prevent flash
        const savedPreset = localStorage.getItem('themePreset');
        const savedFont = localStorage.getItem('fontFamily');
        const savedFontSize = localStorage.getItem('fontSize');
        const savedLineHeight = localStorage.getItem('lineHeight');

        if (savedPreset && savedPreset !== 'default') {
            document.documentElement.setAttribute('data-preset', savedPreset);
        }
        if (savedFont && savedFont !== 'system') {
            document.documentElement.setAttribute('data-font', savedFont);
        }
        if (savedFontSize && savedFontSize !== 'medium') {
            document.documentElement.setAttribute('data-font-size', savedFontSize);
        }
        if (savedLineHeight && savedLineHeight !== 'normal') {
            document.documentElement.setAttribute('data-line-height', savedLineHeight);
        }
    </script>
</head>

<body>
    <main class="settings-page">
        <a href="index.html" class="back-link">
            <span>&#8592;</span> Back to Reader
        </a>

        <h1>Settings</h1>
        <p class="muted">Customize your reading experience</p>

        <!-- Font Settings -->
        <section class="settings-card">
            <h2>Typography</h2>
            <p class="muted">Choose your reading font and size</p>

            <div class="font-settings">
                <div class="setting-row">
                    <div>
                        <label for="fontSelect">Reading Font</label>
                        <div class="description">Select a font for Bible text</div>
                    </div>
                    <select id="fontSelect" class="font-select">
                        <optgroup label="System Fonts">
                            <option value="system">System Default</option>
                            <option value="georgia">Georgia</option>
                            <option value="palatino">Palatino</option>
                            <option value="times">Times New Roman</option>
                            <option value="garamond">Garamond</option>
                            <option value="baskerville">Baskerville</option>
                            <option value="charter">Charter</option>
                        </optgroup>
                        <optgroup label="Serif (Google Fonts)">
                            <option value="merriweather">Merriweather</option>
                            <option value="lora">Lora</option>
                            <option value="source-serif">Source Serif</option>
                            <option value="literata">Literata</option>
                            <option value="eb-garamond">EB Garamond</option>
                            <option value="libre-baskerville">Libre Baskerville</option>
                        </optgroup>
                        <optgroup label="Sans-Serif (Google Fonts)">
                            <option value="open-sans">Open Sans</option>
                            <option value="roboto">Roboto</option>
                            <option value="inter">Inter</option>
                            <option value="atkinson">Atkinson Hyperlegible</option>
                        </optgroup>
                    </select>
                </div>

                <div class="setting-row">
                    <div>
                        <label for="fontSizeSelect">Text Size</label>
                        <div class="description">Adjust the reading text size</div>
                    </div>
                    <select id="fontSizeSelect" class="font-select">
                        <option value="small">Small</option>
                        <option value="medium">Medium (Default)</option>
                        <option value="large">Large</option>
                        <option value="x-large">Extra Large</option>
                    </select>
                </div>

                <div class="setting-row">
                    <div>
                        <label for="lineHeightSelect">Line Spacing</label>
                        <div class="description">Adjust space between lines</div>
                    </div>
                    <select id="lineHeightSelect" class="font-select">
                        <option value="compact">Compact</option>
                        <option value="normal">Normal (Default)</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="spacious">Spacious</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Font Preview -->
        <section class="settings-card">
            <h2>Preview</h2>
            <div id="fontPreview" style="display: flex; flex-direction: column; gap: 1rem;">
                <!-- Sample verse with font applied -->
                <div class="preview-text" style="padding: 1rem; background: var(--bg-surface); border-radius: var(--radius-small); font-family: var(--font-reading); font-size: var(--font-size-base); line-height: var(--line-height-base);">
                    <span style="color: var(--accent-primary); font-weight: 700; margin-right: 0.5rem;">1</span>
                    In the beginning God created the heavens and the earth.
                    <span style="color: var(--accent-primary); font-weight: 700; margin-left: 0.5rem; margin-right: 0.5rem;">2</span>
                    Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters.
                </div>
                <div class="preview-text" style="padding: 1rem; padding-top: 0; background: var(--bg-surface); border-radius: var(--radius-small); font-family: var(--font-reading); font-size: var(--font-size-base); line-height: var(--line-height-base); margin-top: calc(-1rem + var(--paragraph-spacing));">
                    <span style="color: var(--accent-primary); font-weight: 700; margin-right: 0.5rem;">3</span>
                    And God said, "Let there be light," and there was light.
                </div>

                <!-- Font info display -->
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    Font: <strong id="currentFontDisplay">System Default</strong> |
                    Size: <strong id="currentSizeDisplay">Medium</strong> |
                    Spacing: <strong id="currentLineHeightDisplay">Normal</strong>
                </div>
            </div>
        </section>

        <!-- Theme Presets -->
        <section class="settings-card">
            <h2>Theme</h2>
            <p class="muted">Choose a color theme for the reader</p>

            <div class="preset-selector">
                <button class="preset-button" data-preset="default">
                    Default Blue
                </button>
                <button class="preset-button" data-preset="dark">
                    Dark Mode
                </button>
                <button class="preset-button" data-preset="blue">
                    Ocean Teal
                </button>
                <button class="preset-button" data-preset="green">
                    Forest Green
                </button>
                <button class="preset-button" data-preset="orange">
                    Sunset Orange
                </button>
                <button class="preset-button" data-preset="purple">
                    Purple Haze
                </button>
                <button class="preset-button" data-preset="sepia">
                    Sepia Classic
                </button>
                <button class="preset-button" data-preset="grayscale">
                    Grayscale
                </button>
            </div>
        </section>

        <!-- About -->
        <section class="settings-card">
            <h2>About Settings</h2>
            <div class="setting-row">
                <div>
                    <label>Automatic Saving</label>
                    <div class="description">
                        All settings are saved automatically and will be remembered when you return.
                    </div>
                </div>
            </div>
            <div class="setting-row">
                <div>
                    <label>Keyboard Shortcut</label>
                    <div class="description">
                        Press <strong>Ctrl + Shift + T</strong> to quickly toggle between light and dark mode.
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        Settings are saved automatically
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const root = document.documentElement;
            const themeButtons = document.querySelectorAll(".preset-button");
            const fontSelect = document.getElementById("fontSelect");
            const fontSizeSelect = document.getElementById("fontSizeSelect");
            const lineHeightSelect = document.getElementById("lineHeightSelect");
            const currentFontDisplay = document.getElementById("currentFontDisplay");
            const currentSizeDisplay = document.getElementById("currentSizeDisplay");
            const currentLineHeightDisplay = document.getElementById("currentLineHeightDisplay");

            // Font name mapping
            const fontNames = {
                'system': 'System Default',
                'georgia': 'Georgia',
                'palatino': 'Palatino',
                'times': 'Times New Roman',
                'garamond': 'Garamond',
                'baskerville': 'Baskerville',
                'charter': 'Charter',
                'merriweather': 'Merriweather',
                'lora': 'Lora',
                'source-serif': 'Source Serif',
                'literata': 'Literata',
                'eb-garamond': 'EB Garamond',
                'libre-baskerville': 'Libre Baskerville',
                'open-sans': 'Open Sans',
                'roboto': 'Roboto',
                'inter': 'Inter',
                'atkinson': 'Atkinson Hyperlegible'
            };

            const sizeNames = {
                'small': 'Small',
                'medium': 'Medium',
                'large': 'Large',
                'x-large': 'Extra Large'
            };

            const lineHeightNames = {
                'compact': 'Compact',
                'normal': 'Normal',
                'relaxed': 'Relaxed',
                'spacious': 'Spacious'
            };

            // Load saved settings
            const savedPreset = localStorage.getItem("themePreset") || "default";
            const savedFont = localStorage.getItem("fontFamily") || "system";
            const savedFontSize = localStorage.getItem("fontSize") || "medium";
            const savedLineHeight = localStorage.getItem("lineHeight") || "normal";

            // Apply saved settings
            setTheme(savedPreset);
            setFont(savedFont);
            setFontSize(savedFontSize);
            setLineHeight(savedLineHeight);
            updateThemeActiveButton(savedPreset);
            fontSelect.value = savedFont;
            fontSizeSelect.value = savedFontSize;
            lineHeightSelect.value = savedLineHeight;
            updateDisplayLabels();

            // Theme button listeners
            themeButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    const preset = btn.dataset.preset;
                    setTheme(preset);
                    localStorage.setItem("themePreset", preset);
                    updateThemeActiveButton(preset);
                    showConfirmation(`Theme: ${getThemeName(preset)}`);
                });
            });

            // Font select listener
            fontSelect.addEventListener("change", () => {
                const font = fontSelect.value;
                setFont(font);
                localStorage.setItem("fontFamily", font);
                updateDisplayLabels();
                showConfirmation(`Font: ${fontNames[font]}`);
            });

            // Font size select listener
            fontSizeSelect.addEventListener("change", () => {
                const size = fontSizeSelect.value;
                setFontSize(size);
                localStorage.setItem("fontSize", size);
                updateDisplayLabels();
                showConfirmation(`Size: ${sizeNames[size]}`);
            });

            // Line height select listener
            lineHeightSelect.addEventListener("change", () => {
                const lineHeight = lineHeightSelect.value;
                setLineHeight(lineHeight);
                localStorage.setItem("lineHeight", lineHeight);
                updateDisplayLabels();
                showConfirmation(`Spacing: ${lineHeightNames[lineHeight]}`);
            });

            // Apply theme
            function setTheme(presetName) {
                if (presetName === "default") {
                    root.removeAttribute("data-preset");
                } else {
                    root.setAttribute("data-preset", presetName);
                }
            }

            // Apply font
            function setFont(fontName) {
                if (fontName === "system") {
                    root.removeAttribute("data-font");
                } else {
                    root.setAttribute("data-font", fontName);
                }
            }

            // Apply font size
            function setFontSize(size) {
                if (size === "medium") {
                    root.removeAttribute("data-font-size");
                } else {
                    root.setAttribute("data-font-size", size);
                }
            }

            // Apply line height
            function setLineHeight(lineHeight) {
                if (lineHeight === "normal") {
                    root.removeAttribute("data-line-height");
                } else {
                    root.setAttribute("data-line-height", lineHeight);
                }
            }

            // Update theme active button
            function updateThemeActiveButton(activePreset) {
                themeButtons.forEach(btn => {
                    btn.classList.toggle("active", btn.dataset.preset === activePreset);
                });
            }

            // Update display labels
            function updateDisplayLabels() {
                const currentFont = fontSelect.value;
                const currentSize = fontSizeSelect.value;
                const currentLineHeight = lineHeightSelect.value;
                currentFontDisplay.textContent = fontNames[currentFont] || currentFont;
                currentSizeDisplay.textContent = sizeNames[currentSize] || currentSize;
                currentLineHeightDisplay.textContent = lineHeightNames[currentLineHeight] || currentLineHeight;
            }

            // Get friendly theme name
            function getThemeName(preset) {
                const names = {
                    'default': 'Default Blue',
                    'dark': 'Dark Mode',
                    'blue': 'Ocean Teal',
                    'green': 'Forest Green',
                    'orange': 'Sunset Orange',
                    'purple': 'Purple Haze',
                    'sepia': 'Sepia Classic',
                    'grayscale': 'Grayscale'
                };
                return names[preset] || preset;
            }

            // Show confirmation toast
            function showConfirmation(message) {
                let toast = document.getElementById('settings-toast');

                if (!toast) {
                    toast = document.createElement('div');
                    toast.id = 'settings-toast';
                    toast.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        background: var(--toast-bg);
                        color: var(--toast-text);
                        padding: 12px 20px;
                        border-radius: var(--radius-medium);
                        box-shadow: var(--shadow-strong);
                        opacity: 0;
                        transform: translateY(20px);
                        transition: opacity 0.3s ease, transform 0.3s ease;
                        z-index: 1000;
                        font-size: 0.9rem;
                        pointer-events: none;
                    `;
                    document.body.appendChild(toast);
                }

                toast.textContent = message;

                // Show
                setTimeout(() => {
                    toast.style.opacity = '1';
                    toast.style.transform = 'translateY(0)';
                }, 10);

                // Hide after 2 seconds
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(20px)';
                }, 2000);
            }

            // Keyboard shortcut: Ctrl+Shift+T to toggle dark mode
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    const currentPreset = localStorage.getItem("themePreset") || "default";
                    const newPreset = currentPreset === 'dark' ? 'default' : 'dark';
                    setTheme(newPreset);
                    localStorage.setItem("themePreset", newPreset);
                    updateThemeActiveButton(newPreset);
                    showConfirmation(`Switched to ${getThemeName(newPreset)}`);
                }
            });
        });
    </script>
</body>
</html>
